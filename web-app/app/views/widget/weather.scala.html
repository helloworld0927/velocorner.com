@(location: String, restUrl: String)(implicit assets: AssetsFinder)

<!-- Wather widget with 5 days forecast -->
<div class="tag-box tag-box-v2 box-shadow shadow-effect-1">
    <div class="row">
        <div class="col-md-3 col-sm-12">
            <span>
                <img style="width: 16px; height:16px;" src="@assets.path("images/icons/sun-64.png")" alt="Forecast">
                Forecast
            </span>
            <div class="input-group animated fadeInDown">
                <input id="weather" name="weather" type="text" value="@location" class="form-control" placeholder="Location">
                <span class="input-group-btn">
                    <button id="weather_button" name="weather_button" class="btn-u rounded btn-block" type="button"><i class="fa fa-refresh"></i> Weather</button>
                </span>
            </div>
            <div id="weather-progress" class="progress progress-striped active" style="visibility:hidden;">
                <div id="weather-progress-bar" class="progress-bar progress-bar-info"
                     role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                    Refreshing Weather Forecast ...
                </div>
            </div>

            <div id="sunrise-sunset" style="text-align: center; visibility:hidden;">
                <i class="icon-weather-025 mb-10" style="font-size: 1.5em;"></i>
                <span id="weather-sunrise" style="font-size: 1.8em;"></span>
                &nbsp;&nbsp;
                <i class="icon-weather-024 mb-10" style="font-size: 1.5em;"></i>
                <span id="weather-sunset" style="font-size: 1.8em;"></span>
            </div>
        </div>

        <div class="col-md-9 col-sm-12">
            <div id="weather-container" style="max-width: 800px; min-width: 300px; height: 250px; margin: 0 auto; display: none;">
                <div style="margin-top: 0px; text-align: center" id="loading">
                    <i class="fa fa-spinner fa-spin"></i> Loading meteo data
                </div>
            </div>
        </div>

    </div>
</div>

<script type="text/javascript" src="@routes.Assets.at("javascripts/meteogram.js")"></script>
<script type="text/javascript" src="@routes.Assets.at("highcharts/modules/windbarb.src.js")"></script>
<script type="text/javascript" src="@routes.Assets.at("highcharts/modules/pattern-fill.js")"></script>
<script type="text/javascript">//<![CDATA[
    $(document).ready(function() {
        $('#weather_button').click(function() {
            triggerForecast();
        });
        $('#weather').keypress(function(e) {
            if (e.which == 13) {
                triggerForecast()
            }
        });

        triggerForecast();
    });

    function triggerForecast() {
        var place = $('#weather').val();
        if (place) {
            console.log('forecast for ' + place);
            weatherForecast(place);
        } else {
            console.log("won't request weather forecast, place is not set");
        }
    }

    function weatherForecast(place) {
        $('#weather-progress').css("visibility","visible");

        // meteogram
        $.ajax({
            dataType: 'xml',
            url: "@restUrl/weather/" + place + "?mode=xml",
            success: function (xml) {
                $('#weather-progress').css("visibility","hidden");
                $('#weather-container').css('display', 'block');
                window.meteogram = new Meteogram(xml, 'weather-container');
            },
            error: function(e) {
                $('#weather-progress').css("visibility","hidden");
                console.error("meteogram with " + e);
            }
        });

        // sunrise and sunset
        $.ajax({
            dataType: 'json',
            url: "@restUrl/sunrise/" + place,
            success: function (data) {
                $('#sunrise-sunset').css("visibility","visible");
                $('#weather-sunrise').html(moment.unix(data.sunrise).format('H:mm'));
                $('#weather-sunset').html(moment.unix(data.sunset).format('H:mm'));
            }
        });

    }
//]]>
</script>